\begin{tikzpicture}

\fill[rounded corners,color=red,opacity=1] (-3,2) rectangle (-1,0);
\fill[rounded corners,color=violet,opacity=1]  (5,2) rectangle (7,0);
\node (v1) at (-2,3) {\Large $x$};
\coordinate (v2) at (-2,2) {};
\node (v3) at (-1,1) {};
\coordinate (v4) at (5,1) {} {};
\node (v5) at (6,3) {\Large $y$};
\coordinate (v6) at (6,2) {} {};
\node (v7) at (6.5,0) {};
\node (v8) at (6.5,-1.5) {\Large $z=f(x,y)$};
\draw[-triangle 90]  (v1) edge  (v2);
\draw[-triangle 90,line width=2pt]  (v3) edge node[above] {\Large $m\in\{1,...,d\}$} node[below] {\Large $\rho_x \in \mathcal{P}(\mathbb{C}^d) $} (v4);
\draw[-triangle 90]  (v5) edge (v6);
\draw[-triangle 90]  (v7) edge (v8);
\fill[rounded corners,color=red,opacity=1]  (-3,-5) rectangle (-1,-7) node (v9) {};
\fill[rounded corners,color=violet,opacity=1]  (5,-5) rectangle (7,-7);
\node (v10) at (-2.5,-4) {\Large $a_1=x$};
\coordinate (v11) at (-2.5,-5) {} {};
\node (v12) at (-1,-6) {};
\coordinate (v13) at (5,-6) {} {};
\node (v14) at (6,-4) {\Large $b=y$};
\coordinate (v15) at (6,-5) {} {};
\node (v16) at (6.5,-7) {};
\node (v17) at (6.5,-9) {\Large \(
        c=
        \begin{cases}
        f(x,y) \ & \mbox{if } a_{2} = 1 \\
        f(x,y)\oplus 1 \ & \mbox{if } a_{2} = 2
	    \end{cases}
        \)};
\draw[-triangle 90]  (v10) edge (v11);
\draw[-triangle 90,line width=2pt]  (v12)  edge node[above] {\Large $p(m|x,a_2)=p(m|a_2)$} node[below] {\Large $\sum_{x}\rho_{x,a_2=0}=\sum_{x}\rho_{x,a_2=1}$} (v13);
\draw[-triangle 90]  (v14) edge (v15);
\draw[-triangle 90]  (v16) edge (v17);
\node (v18) at (-1.5,-3) {\Large $a_2\in \{1,2\}$};
\coordinate (v19) at (-1.5,-5) {};
\draw[-triangle 90]  (v18) edge (v19);
\node (v20) at (2,-1) {};
\node (v21) at (2,-4) {};
\draw[-triangle 90,line width=15pt,color=orange]  (v20) edge (v21);
\node at (2,-0.5) {\Huge $\mathcal{CC}_d$};
\node at (2,-4.5) {\Huge $\mathcal{OC}_{x}$};
\fill[color=black]  (6.25,0.35) ellipse (0.15 and 0.15);
\fill[color=white]  (6.75,0.35) ellipse (0.15 and 0.15);
\fill[color=black]  (6.25,-6.65) ellipse (0.15 and 0.15);
\fill[color=white]  (6.75,-6.65) ellipse (0.15 and 0.15);
\end{tikzpicture}